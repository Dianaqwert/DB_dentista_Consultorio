<div class="row">
    <div class="col-md-6">
        <div class="input-group mb-3">
            <input type="text" class="form-control" placeholder="Buscar paciente o fecha..." 
                   [(ngModel)]="terminoBusqueda" (keyup.enter)="buscar()">
            <button class="btn btn-primary" (click)="buscar()"><i class="bi bi-search"></i></button>
        </div>
        
        <div class="list-group">
            @for (c of citasPendientes; track c.id_cita) {
                <button class="list-group-item list-group-item-action" 
                        (click)="seleccionarCita(c)"
                        [class.active]="citaSeleccionada?.id_cita === c.id_cita">
                    <div class="d-flex w-100 justify-content-between">
                        <h6 class="mb-1">{{ c.nombre_paciente }}</h6>
                        <small>{{ c.fecha_hora | date:'shortDate' }}</small>
                    </div>
                    <p class="mb-1">Debe: ${{ c.saldo_pendiente }}</p>
                </button>
            }
        </div>
    </div>

    <div class="col-md-6">
        @if (citaSeleccionada) {
            <div class="card border-primary">
                <div class="card-header bg-primary text-white">
                    Detalle de Cobro
                </div>
                <div class="card-body">
                    <h5>Total Deuda: ${{ citaSeleccionada.monto_total }}</h5>
                    <h6 class="text-danger">Restante: ${{ citaSeleccionada.saldo_pendiente }}</h6>
                    <hr>
                    
                    <div class="mb-3">
                        <label>Monto a Pagar:</label>
                        <input type="number" class="form-control form-control-lg" [(ngModel)]="montoPagar">
                    </div>
                    
                    <div class="mb-3">
                        <label>MÃ©todo de Pago:</label>
                        <select class="form-select" [(ngModel)]="metodoSeleccionado">
                            @for (m of metodosPago; track m.id_metodo_pago) {
                                <option [value]="m.id_metodo_pago">{{ m.nombre_metodo }}</option>
                            }
                        </select>
                    </div>

                    <button class="btn btn-success w-100 btn-lg" (click)="procesarCobro()">
                        <i class="bi bi-cash-coin"></i> COBRAR
                    </button>
                </div>
            </div>
        } @else {
            <div class="alert alert-info mt-3">Selecciona una cita de la izquierda para cobrar.</div>
        }
    </div>
</div>